import os
import subprocess
import threading
import time
import shutil


# -------------------------------------Thread definition----------------------------------------------------------------

class myThread(threading.Thread):  # thread definition updated in python 3.0
    def __init__(self, threadID, threadName, name, ip):
        threading.Thread.__init__(self)
        self.threadID = threadID
        self.threadName = threadName
        self.name = name
        self.ip = ip

    def run(self):
        print("Starting " + self.threadName)
        crack_password(self.threadName, self.name, self.ip)
        print("Exiting " + self.threadName)


# ----------------------------------------------------------------------------------------------------------------------

# ---------------------------------------------Methodes------------------------------------------------------------------

def crack_password(threadName, name, ip):  # scan def for threads to run
    print(threadName + " works")
    stream = os.system("hydra -l " + name + " -o Results/PasswordCracker/" + x +
                      " -P Resources/passwordCrack/fullcustomhoppenbrouwerslist500.txt -t 2 " + ip + " http-get -m / -V")
    print(stream.read())

# ----------------------------------------------------------------------------------------------------------------------

approvedstart = False
correct = False
answered = False
name = ""
Filename = ""
f = open("Resources/passwordCrack/Usernames")  # get ip adresses from file
threads = []
threadnumber = 1
f1 = f.readlines()

print("Welcome to the PassCracker!")
ipToCrack = input("What is the ip of the login server that we will be cracking?")
print("Make sure the username list is filled in the Resources folder.")
while not correct:
    cracktype = input(
        "do you want to use the standard cracklist(fast) or individualized passwords? (standard/special)").lower()
    if cracktype == "standard" or cracktype == "special":
        correct = True
start = input("are you ready? (yes/no)")
start = start.lower()

if start == "yes":
    approvedstart = True

if approvedstart:
    for x in f1:
        if cracktype == "standard":
            while threading.activeCount() > 10:  # dont go above 10 threads at the same time
                print("max threads achived, waiting for space")
                time.sleep(10)
            thread = myThread(1, "Thread-" + str(threadnumber), x, ipToCrack)  # creating thread
            thread.start()
            threads.append(thread)  # add to pool
            threadnumber += 1
        elif cracktype == "special":
            os.system("python3 Resources/externalScripts/cupp/cupp.py -i")
            name = input("input name from .txt file please")
            NewPath = shutil.copy(name + ".txt", 'Resources/passwordCrack/')
            print("cause of gui reasons there is a problem running the mentalist to enhance the password list automatically")
            print("the mentalist increases chances of succes but takes longer and takes some extra steps")
            while answered:
                answer = input("do you want to run the mentalist? (yes/no)").lower()
                if answer == "yes":
                    answered = True
                    print("with the mentalist you will want to first delete the english dictionary")
                    print("you can do this by pressing the - on the left side of the english dictionary")
                    print("after deleting this you will want to press the + button on the right of base words")
                    print("select custom file from the list that will pop up and select the created list from")
                    print("the made list from before. you can find this list in DownloadLocation/Resources/passwordCrack/" + name)
                    print("After this is added click on the + icon at the top right and select the following: case and append")
                    print("on the right of case click the + icon and select both options in lowercase and both options in uppercase")
                    print("on the right of append click the + icon and hover over numbers and click Small 0 - 100")
                    print("after these settings press process full wordlist and place it in the passwordCrack folder")
                    input("press enter after reading")
                    subprocess.run("mentalist", shell=True)
                    Filename = input("input the name of the file without the .txt")
                elif answer == "no":
                    answered = True
                    Filename = name
            stream = os.system("hydra -l " + x + "-P Resources/passwordCrack/" + Filename + ".txt -t 6 " + ipToCrack)
        else:
            print("Error!")
