import os
import threading
import time


class myThread(threading.Thread): 					   #thread definition updated in python 3.0
    def __init__(self, threadID, name, adress):
        threading.Thread.__init__(self)
        self.threadID = threadID
        self.name = name
        self.adress = adress

    def run(self):
        print("Starting " + self.name)
        run_scan(self.adress, self.name)
        print("Exiting " + self.name)


def run_scan(adress, threadName): 					   #scan def for threads to run
    print(threadnumber + " works")
    stream = os.popen('nmap -sV --script=vulscan -T2 -v -Pn -A ' + adress) #execute command in terminal from script
    output = stream.read()
    f = open("Results/NetworkScan/" + adress + ".txt", "w+")		   #make a text file with the name of the adress
    f.write(output)							   #fill the text file
    f.close()

f = open("Resources/ipAdressesToScan")					   #get ip adresses from file
threads = []
threadnumber = 1
f1 = f.readlines()

for x in f1:
    while threading.activeCount() < 10:					   #dont go above 10 threads at the same time
        print("max threads achived, waiting for space")
        time.sleep(10)
    thread = myThread(1, "Thread-" + str(threadnumber), x)		   #creating thread
    thread.start()
    threads.append(thread)						   #add to pool
    threadnumber += 1

